#!//anaconda/bin/python

#/Users/sebastianducheneAIr/anaconda/bin/python


import dendropy as dp
import sys, re, copy

def get_phylogs(trees_in):
    '''
    The trees should be read as a Tree list in dendropy
    ''' 
    trees_out = list()

    for t in trees_in:
        t_new = copy.deepcopy(t)
        
        for b in t_new.postorder_edge_iter():
            b.length = b.length * float(b.head_node.annotations['rate'])

        trees_out.append(t_new)

    return(trees_out)

input_file = sys.argv[1]


trees_in_comp = dp.TreeList.get_from_path(input_file, 'nexus', extract_comment_metadata = True)

# Modified code to run only the last 100 trees
trees_in = trees_in_comp[(len(trees_in_comp) - 100):len(trees_in_comp)]


trs = get_phylogs(trees_in)

out_file = re.sub('[.].+$', '_phylogs.trees', input_file)

output = open(out_file, 'w')
for t in trs:
    output.write(t)
output.close()


