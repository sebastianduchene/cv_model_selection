library(ape)
library(NELSI)


strict_clocks <- paste0('runs/', dir('runs/', pattern = 'strict[.]log'))

# modify to run only last 100 trees
for(r in 1:length(strict_clocks)){
    log_temp <- read.table(strict_clocks[r], head = T)
log_temp <- log_temp[(nrow(log_temp) - 100):nrow(log_temp), ]
    tree_temp <- read.nexus(gsub('log', 'trees', strict_clocks[r]))
tree_temp <- tree_temp[(length(tree_temp) - 100):length(tree_temp)] 
    print(r)
    phylogs_temp <- list()
    for(t in 1:length(tree_temp)){
        phylogs_temp[[t]] <- tree_temp[[t]]
        phylogs_temp[[t]]$edge.length <- tree_temp[[t]]$edge.length * log_temp$clockRate[t]
    }
    class(phylogs_temp) <- 'multiPhylo'
    write.tree(phylogs_temp, file = gsub('[.]log', '_phylogs.trees', strict_clocks[r]))
}

